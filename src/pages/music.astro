---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getRecentPlaylists } from '../content/music';

const playlists = getRecentPlaylists(10);

// Force compact player (no large header artwork) by setting visual=false
function getCompactEmbedUrl(url: string): string {
  const parsed = new URL(url);
  parsed.searchParams.set('visual', 'false');
  return parsed.toString();
}
---

<BaseLayout title="Music - Blog26" description="Recent listens and mixes">
  <h1>Music</h1>
  <p class="intro">Recent listens, mixes, and sounds.</p>

  {playlists.length > 0 ? (
    <section class="playlists">
      {playlists.map((playlist) => (
        <article class="playlist">
          <div class="playlist-info">
            <h2>{playlist.name}</h2>
            {playlist.artist && <p class="artist">{playlist.artist}</p>}
            {playlist.description && <p class="description">{playlist.description}</p>}
          </div>
          <div class="player">
            <iframe
              width="100%"
              height="1100"
              scrolling="no"
              frameborder="no"
              allow="autoplay"
              src={getCompactEmbedUrl(playlist.embedUrl)}
            ></iframe>
          </div>
        </article>
      ))}
    </section>
  ) : (
    <section class="empty-state">
      <p>No playlists added yet.</p>
      <p class="hint">Add playlists to <code>src/content/music.ts</code> to display them here.</p>

      <div class="instructions">
        <h2>How to add playlists:</h2>
        <ol>
          <li>Go to a playlist on Soundcloud</li>
          <li>Click <strong>Share</strong> &rarr; <strong>Embed</strong></li>
          <li>Copy the <code>src</code> URL from the iframe code</li>
          <li>Add it to the playlists array in <code>src/content/music.ts</code></li>
        </ol>
      </div>
    </section>
  )}
</BaseLayout>

<style>
  h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .intro {
    color: var(--color-muted);
    margin-bottom: 2rem;
  }

  .playlists {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .playlist {
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
  }

  .playlist-info {
    padding: 1rem 1.5rem;
    background: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
  }

  .playlist-info h2 {
    font-size: 1.125rem;
    margin-bottom: 0.25rem;
  }

  .artist {
    color: var(--color-muted);
    font-size: 0.875rem;
  }

  .description {
    color: var(--color-muted);
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .player {
    padding: 1rem;
  }

  .player iframe {
    border-radius: 4px;
  }

  .empty-state {
    padding: 3rem;
    background: #f9fafb;
    border-radius: 12px;
    text-align: center;
  }

  .empty-state p {
    color: var(--color-muted);
    margin-bottom: 0.5rem;
  }

  .hint code {
    background: #e5e7eb;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
  }

  .instructions {
    margin-top: 2rem;
    padding: 1.5rem;
    background: white;
    border-radius: 8px;
    text-align: left;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  .instructions h2 {
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .instructions ol {
    padding-left: 1.5rem;
    color: var(--color-muted);
  }

  .instructions li {
    margin-bottom: 0.5rem;
  }

  .instructions code {
    background: #f3f4f6;
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.875rem;
  }
</style>
